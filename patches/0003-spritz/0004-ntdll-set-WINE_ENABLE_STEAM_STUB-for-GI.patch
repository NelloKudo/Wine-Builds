From bf076e3d7fbe98cfcf4a12e892dc9bf059ee3043 Mon Sep 17 00:00:00 2001
From: NelloKudo <marshnelloosu@gmail.com>
Date: Thu, 18 Sep 2025 11:50:52 +0200
Subject: [PATCH] ntdll: set WINE_ENABLE_STEAM_STUB for GI

Based on Proton's hacks_init() function.
---
 dlls/ntdll/unix/loader.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/dlls/ntdll/unix/loader.c b/dlls/ntdll/unix/loader.c
index 44d3ec5c4c9..3556b402010 100644
--- a/dlls/ntdll/unix/loader.c
+++ b/dlls/ntdll/unix/loader.c
@@ -1965,6 +1965,9 @@ static void hacks_init(void)
     const char *sgi = getenv( "SteamGameId" );
     const char *env_str;
 
+    if (main_argc > 1 && (strstr(main_argv[1], "GenshinImpact.exe") || strstr(main_argv[1], "YuanShen.exe")))
+        setenv( "WINE_ENABLE_STEAM_STUB", "1", 0 );
+
     env_str = getenv("WINE_SIMULATE_ASYNC_READ");
     if (env_str)
         ac_odyssey = !!atoi(env_str);
-- 
2.51.0

