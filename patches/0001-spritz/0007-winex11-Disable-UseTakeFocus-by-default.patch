From b6fd3db69359ac9ed6268a635ee49025ad47f8ed Mon Sep 17 00:00:00 2001
From: NelloKudo <marshnelloosu@gmail.com>
Date: Tue, 7 Oct 2025 01:58:45 +0200
Subject: [PATCH] winex11: Disable UseTakeFocus by default

---
 dlls/winex11.drv/x11drv_main.c | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/dlls/winex11.drv/x11drv_main.c b/dlls/winex11.drv/x11drv_main.c
index 69656ec42bb..c42cc75d4d8 100644
--- a/dlls/winex11.drv/x11drv_main.c
+++ b/dlls/winex11.drv/x11drv_main.c
@@ -70,7 +70,7 @@ BOOL usexvidmode = TRUE;
 BOOL usexrandr = TRUE;
 BOOL usexcomposite = TRUE;
 BOOL use_xfixes = FALSE;
-BOOL use_take_focus = TRUE;
+BOOL use_take_focus = FALSE;
 BOOL use_primary_selection = FALSE;
 BOOL use_system_cursors = TRUE;
 BOOL grab_fullscreen = FALSE;
@@ -807,6 +807,12 @@ static NTSTATUS x11drv_init( void *arg )
 
     setup_options();
 
+    // HACK: Allow overriding use_take_focus with env. var, besides regedit.
+    // Useful for Unity games losing inputs after alt-tab.
+    const char *env = getenv("WINE_ENABLE_USE_TAKE_FOCUS");
+    if (env && atoi(env) == 1)
+        use_take_focus = TRUE;
+
     /* Open display */
 
     if (!XInitThreads()) ERR( "XInitThreads failed, trouble ahead\n" );
-- 
2.51.0

